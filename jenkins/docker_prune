#!/bin/bash

set -euo pipefail

echo "üîç –ò—â–µ–º –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã gradle:* ..."
mapfile -t gradle_images < <(docker images --format '{{.Repository}}:{{.Tag}}' | grep '^gradle:')

if ((${#gradle_images[@]} == 0)); then
  echo "‚ÑπÔ∏è –û–±—Ä–∞–∑—ã gradle:* –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ–º –æ—á–∏—Å—Ç–∫—É."
else
  echo "üì¶ –ù–∞–π–¥–µ–Ω—ã –æ–±—Ä–∞–∑—ã gradle:"
  printf ' - %s\n' "${gradle_images[@]}"
fi

echo "üßπ –ó–∞–ø—É—Å–∫–∞–µ–º docker system prune..."
docker system prune -a --volumes -f

if ((${#gradle_images[@]} > 0)); then
  echo "üì• –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–∑—ã gradle..."
  for image in "${gradle_images[@]}"; do
    echo "‚¨áÔ∏è Pulling $image ..."
    docker pull "$image" || echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å $image"
  done
fi

echo "üéØ –ì–æ—Ç–æ–≤–æ! –í—Å–µ gradle –æ–±—Ä–∞–∑—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏."
